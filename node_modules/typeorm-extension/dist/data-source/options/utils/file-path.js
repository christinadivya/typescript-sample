"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.adjustFilePathsForDataSourceOptions = void 0;
const utils_1 = require("../../../utils");
const tsconfig_1 = require("../../../utils/tsconfig");
const keys = [
    'entities',
    'migrations',
    'seeds',
    'factories',
    'subscribers',
];
async function adjustFilePathsForDataSourceOptions(input, options) {
    if ((0, utils_1.isCodeTransformation)(utils_1.CodeTransformation.JUST_IN_TIME)) {
        return input;
    }
    options = options || {};
    const { compilerOptions } = await (0, tsconfig_1.readTsConfig)(options.root);
    for (let i = 0; i < keys.length; i++) {
        const key = keys[i];
        if (!(0, utils_1.hasOwnProperty)(input, key) ||
            (options.keys && options.keys.indexOf(key) === -1)) {
            continue;
        }
        let value = input[key];
        if (typeof value === 'string') {
            value = (0, utils_1.transformFilePath)(value, compilerOptions?.outDir);
        }
        else if (Array.isArray(value)) {
            for (let i = 0; i < value.length; i++) {
                if (typeof value[i] === 'string') {
                    value[i] = (0, utils_1.transformFilePath)(value[i], compilerOptions?.outDir);
                }
            }
        }
        input[key] = value;
    }
    return input;
}
exports.adjustFilePathsForDataSourceOptions = adjustFilePathsForDataSourceOptions;
